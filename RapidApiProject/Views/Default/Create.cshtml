@model CreateMediaVM
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    var backUrl = ViewBag.ReturnUrl as string
                  ?? Url.Action("Index", "Default", new { type = Model.Type });
}

<section class="py-8">
    <div class="mx-auto max-w-3xl bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-800 rounded-2xl p-6 shadow-sm">
        <div class="flex items-center justify-between mb-6">
            <h1 class="text-2xl font-bold">Create – @Model.Type?.ToUpperInvariant()</h1>
            <a href="@backUrl"
               class="inline-flex items-center gap-2 px-3 py-2 rounded-xl border border-gray-200 dark:border-gray-800 hover:bg-gray-100 dark:hover:bg-gray-800 transition text-sm">
                <i class="fa-solid fa-arrow-left-long"></i> Back
            </a>
        </div>

        @Html.ValidationSummary(excludePropertyErrors: true, message: null,
                 htmlAttributes: new { @class = "mb-4 text-sm text-rose-600" })

        <!-- !!! Controller'ı Default yaptık -->
        <form asp-action="Create" asp-controller="Default" method="post" class="space-y-5">


            @Html.AntiForgeryToken()
            <input type="hidden" name="returnUrl" value="@backUrl" />

            <!-- Type -->
            <div>
                <label class="block text-sm font-medium mb-1">Type</label>
                <select asp-for="Type"
                        class="w-full rounded-xl border border-gray-300 dark:border-gray-700
                               bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 px-3 py-2">
                    <option value="">— Select —</option>
                    <option value="movie">Movie</option>
                    <option value="series">Series</option>
                    <option value="game">Game</option>
                </select>
                <span asp-validation-for="Type" class="text-sm text-rose-600"></span>
            </div>

            <!-- Title -->
            <div>
                <label class="block text-sm font-medium mb-1">Title</label>
                <input asp-for="Title" class="w-full rounded-xl border border-gray-300 dark:border-gray-700 bg-transparent px-3 py-2" />
                <span asp-validation-for="Title" class="text-sm text-rose-600"></span>
            </div>

            <!-- Image URL + Preview -->
            <div>
                <label class="block text-sm font-medium mb-1">Image URL</label>
                <input asp-for="Image" placeholder="https://..." class="w-full rounded-xl border border-gray-300 dark:border-gray-700 bg-transparent px-3 py-2" />
                <span asp-validation-for="Image" class="text-sm text-rose-600"></span>
                <div class="mt-3">
                    <img id="preview" src="@(string.IsNullOrWhiteSpace(Model.Image) ? "https://via.placeholder.com/600x400?text=Preview" : Model.Image)"
                         class="h-48 w-full object-cover rounded-xl border border-gray-200 dark:border-gray-800" />
                </div>
            </div>

            <!-- Rating (string) -->
            <div>
                <label class="block text-sm font-medium mb-1">Rating</label>
                <input asp-for="Rating" placeholder="7.8" class="w-full rounded-xl border border-gray-300 dark:border-gray-700 bg-transparent px-3 py-2" />
                <span asp-validation-for="Rating" class="text-sm text-rose-600"></span>
            </div>

            <!-- Description -->
            <div>
                <label class="block text-sm font-medium mb-1">Description</label>
                <textarea asp-for="Description" rows="4" class="w-full rounded-xl border border-gray-300 dark:border-gray-700 bg-transparent px-3 py-2"></textarea>
                <span asp-validation-for="Description" class="text-sm text-rose-600"></span>
            </div>

            <!-- Watched switch -->
            <div class="flex items-center gap-3">
                <input asp-for="Watched" type="checkbox" id="watched" class="peer sr-only" />
                <label for="watched"
                       class="relative inline-flex h-6 w-11 cursor-pointer items-center rounded-full bg-gray-300 peer-checked:bg-emerald-500 transition">
                    <span class="absolute left-1 h-5 w-5 rounded-full bg-white peer-checked:translate-x-5 transition"></span>
                </label>
                <span class="text-sm">Watched</span>
            </div>

            <!-- Actions -->
            <div class="pt-2 flex items-center gap-3">
                <button type="submit"
                        class="inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-indigo-600 text-white hover:bg-indigo-700 transition">
                    <i class="fa-solid fa-floppy-disk"></i> Save
                </button>
                <a href="@backUrl"
                   class="inline-flex items-center gap-2 px-4 py-2 rounded-xl border border-gray-200 dark:border-gray-800 hover:bg-gray-100 dark:hover:bg-gray-800 transition">
                    Cancel
                </a>
            </div>
        </form>
    </div>
</section>

@section Scripts {
    <script>
        // Image preview
        const imgInput = document.getElementById('Image');
        const preview = document.getElementById('preview');
        if (imgInput && preview) {
            imgInput.addEventListener('input', () => {
                const v = imgInput.value?.trim();
                preview.src = v || "https://via.placeholder.com/600x400?text=Preview";
            });
        }
    </script>
}
